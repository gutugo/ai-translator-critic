================================================================================
                    ДОКУМЕНТАЦИЯ ПО АВТОТЕСТАМ
                    AI Translator & Critic
================================================================================

ОГЛАВЛЕНИЕ:
1. Обзор архитектуры тестов
2. Unit-тесты (Vitest)
3. E2E-тесты (Cypress)
4. Доработки и улучшения
5. Запуск тестов
6. Структура файлов
7. Best Practices

================================================================================
1. ОБЗОР АРХИТЕКТУРЫ ТЕСТОВ
================================================================================

Тестовая стратегия построена по принципу "Test Pyramid":

                    /\
                   /E2E\          <- 8 тест-сьютов (Cypress)
                  /------\
                 /Интегр. \       <- 2 тест-сьюта (Vitest)
                /----------\
               /  Unit-тесты \    <- 5 тест-сьютов (Vitest)
              /----------------\

Преимущества такого подхода:
- Unit-тесты быстрые и дешевые, ловят логические ошибки
- E2E-тесты дорогие, но проверяют реальный пользовательский опыт
- Mocking на всех уровнях экономит деньги на API-токенах

================================================================================
2. UNIT-ТЕСТЫ (Vitest)
================================================================================

Файл: client/src/lib/mentorpiece.test.ts

ПОКРЫТЫЕ СЦЕНАРИИ:

2.1 Константы (MODELS)
    - Проверка корректного названия модели перевода (Qwen)
    - Проверка корректного названия модели критики (Claude)
    - Проверка количества определенных моделей

2.2 Константы (LANGUAGES)
    - Минимальное количество языков (>=5)
    - Наличие English в списке
    - Наличие Russian в списке
    - Структура объектов языка (value/label)

2.3 Helper-функции (getTranslationPrompt)
    - Включение исходного текста в промпт
    - Включение целевого языка в промпт
    - Наличие инструкции "только перевод"
    - Обработка пустого текста
    - Обработка спецсимволов

2.4 Helper-функции (getCritiquePrompt)
    - Включение оригинала в промпт
    - Включение перевода в промпт
    - Требование оценки 1-10
    - Упоминание критериев качества

2.5 API функция (callLLM)
    - Успешный вызов (200 OK)
    - Правильный endpoint
    - Структура тела запроса
    - Метод POST
    - Обработка ошибки 4xx
    - Обработка ошибки 5xx
    - Обработка ошибки без message
    - Обработка сетевой ошибки
    - Обработка timeout
    - Обработка ошибки парсинга JSON

2.6 Интеграционные тесты
    - Полный цикл перевода
    - Полный цикл критики

================================================================================
3. E2E-ТЕСТЫ (Cypress)
================================================================================

Файл: cypress/e2e/translator_critic.cy.js

ПОКРЫТЫЕ СЦЕНАРИИ:

3.1 Начальное состояние UI (Initial Page Load)
    - Отображение заголовка приложения
    - Отображение поля ввода текста
    - Отображение селектора языка
    - Отображение кнопки перевода
    - Placeholder "Ready to translate"

3.2 Выбор языка (Language Selection)
    - Значение по умолчанию (English)
    - Открытие dropdown
    - Отображение всех языков
    - Обновление выбранного языка
    - Закрытие dropdown после выбора

3.3 Ввод текста (Text Input)
    - Принятие текста
    - Длинный текст
    - Спецсимволы
    - Многострочный текст

3.4 Состояние загрузки (Loading State)
    - Индикатор загрузки
    - Блокировка кнопки

3.5 Успешный сценарий (Happy Path)
    - Полный цикл перевода и оценки
    - Заголовок секции Translation
    - Заголовок EVALUATION REPORT
    - Скрытие placeholder

3.6 Обработка ошибок (Error Handling)
    - Ошибка 500
    - Ошибка 401
    - Сетевая ошибка
    - Retry после ошибки

3.7 Accessibility
    - Фокусируемый textarea
    - Доступная кнопка
    - Роль combobox
    - Навигация с клавиатуры

3.8 Производительность
    - Время загрузки страницы (<5с)
    - Отклик на ввод (<1с)

================================================================================
4. ДОРАБОТКИ И УЛУЧШЕНИЯ (v2.0)
================================================================================

В рамках вайб-кодинга были реализованы следующие доработки:

UNIT-ТЕСТЫ:
+ Добавлены тесты для констант MODELS и LANGUAGES
+ Добавлены тесты для helper-функций getTranslationPrompt и getCritiquePrompt
+ Добавлен тест на обработку ошибки без message
+ Добавлен тест на timeout
+ Добавлен тест на ошибку парсинга JSON
+ Добавлены интеграционные тесты полного цикла

E2E-ТЕСТЫ:
+ Добавлены тесты начального состояния UI (5 тестов)
+ Добавлены тесты выбора языка (5 тестов)
+ Добавлены тесты ввода текста (4 теста)
+ Добавлены тесты loading state (2 теста)
+ Добавлены тесты accessibility (4 теста)
+ Добавлены тесты производительности (2 теста)
+ Расширены тесты обработки ошибок (+3 теста)

УЛУЧШЕНИЯ КАЧЕСТВА:
+ Подробные комментарии на русском языке для обучения QA
+ Логическая группировка тестов по describe-блокам
+ Использование AAA-паттерна (Arrange-Act-Assert)
+ Добавлены проверки edge cases

================================================================================
5. ЗАПУСК ТЕСТОВ
================================================================================

UNIT-ТЕСТЫ (Vitest):
----------------------
# Запуск всех unit-тестов
npx vitest run

# Запуск в watch-режиме (для разработки)
npx vitest

# Запуск конкретного файла
npx vitest run client/src/lib/mentorpiece.test.ts

# Запуск с покрытием кода
npx vitest run --coverage


E2E-ТЕСТЫ (Cypress):
--------------------
# ВАЖНО: Перед запуском убедитесь, что приложение работает на порту 5000
npm run dev

# Запуск в headless режиме (для CI/CD)
npx cypress run

# Запуск в интерактивном режиме (для разработки)
npx cypress open

# Запуск конкретного файла
npx cypress run --spec "cypress/e2e/translator_critic.cy.js"


ЗАПУСК ВСЕХ ТЕСТОВ:
-------------------
# Последовательный запуск
npx vitest run && npx cypress run

================================================================================
6. СТРУКТУРА ФАЙЛОВ
================================================================================

project/
├── client/
│   └── src/
│       ├── lib/
│       │   ├── mentorpiece.ts         # Модуль API (тестируемый код)
│       │   └── mentorpiece.test.ts    # Unit-тесты для API
│       ├── pages/
│       │   ├── Home.tsx               # Главная страница
│       │   └── Home.test.tsx          # Интеграционные тесты UI
│       └── test/
│           └── setup.ts               # Настройка тестового окружения
├── cypress/
│   ├── e2e/
│   │   └── translator_critic.cy.js    # E2E тесты
│   └── screenshots/                   # Скриншоты при падении тестов
├── cypress.config.js                  # Конфигурация Cypress
├── vitest.config.ts                   # Конфигурация Vitest
└── AQA_README.txt                     # Эта документация

================================================================================
7. BEST PRACTICES
================================================================================

MOCKING:
--------
- ВСЕГДА мокайте внешние API, чтобы не тратить деньги на токены
- Используйте vi.fn() для Vitest и cy.intercept() для Cypress
- Мокайте на уровне fetch/HTTP, а не на уровне функций приложения

ИМЕНОВАНИЕ ТЕСТОВ:
------------------
- Используйте формат: "should [ожидаемое поведение] when [условие]"
- Пример: "should throw error when API returns 500"

СТРУКТУРА ТЕСТА (AAA):
----------------------
- Arrange: Подготовка данных и моков
- Act: Выполнение тестируемого действия
- Assert: Проверка результата

ИЗОЛЯЦИЯ:
---------
- Каждый тест должен быть независимым
- Используйте beforeEach для сброса состояния
- Не полагайтесь на порядок выполнения тестов

ЧИТАЕМОСТЬ:
-----------
- Один тест = одна проверка
- Добавляйте комментарии для сложной логики
- Группируйте связанные тесты в describe-блоки

================================================================================
                         КОНЕЦ ДОКУМЕНТАЦИИ
================================================================================
